Function.prototype.inherits=function(b){var a={},d=this.prototype=new b;this.prototype.uber=function(c){c in a||(a[c]=0);var e,f;e=a[c];f=b.prototype;if(e){for(;e;)f=f.constructor.prototype,e-=1;e=f[c]}else e=d[c],e==this[c]&&(e=f[c]);a[c]+=1;f=e.apply(this,Array.prototype.slice.apply(arguments,[1]));a[c]-=1;return f};return this};var vorple={};
(function(b){vorple.core={release:4,version:2,system:null};vorple.core.defaults={target:"_blank"};vorple.core.settings={confirmWindowClose:!1,debug:!1};vorple.core._init=function(a){"undefined"!==typeof a&&(this.system=a);b(".vorple-version").html(this.version+"."+this.release);window.onbeforeunload=function(a){if(vorple.core.settings.confirmWindowClose&&!vorple.core.settings.debug){var c;c=vorple.core.settings.confirmWindowClose===true?"You are about to leave the story. Any unsaved progress will be lost. Are you sure you want to continue?":
vorple.core.settings.confirmWindowClose;if(a)a.returnValue=c;return c}};"undefined"===typeof window.console&&(window.console={log:function(){}})};vorple.core.engine=function(a){var b=!!(vorple.core.system&&"function"===typeof vorple.core.system.setQuality),c=!!(vorple.core.system&&"object"===typeof vorple.core.system.vms);if("string"===typeof a)switch(a){case "undum":return b;case "parchment":return c;default:return!1}return!vorple.core.system?null:b?"undum":c?"parchment":!1};vorple.core.generateId=
function(a){void 0===a&&(a=32);for(var b="",c=0;c<a;++c)var e=0==c?Math.floor(52*Math.random())+10:Math.floor(62*Math.random()),b=10>e?b+(""+e):36>e?b+String.fromCharCode(e+55):b+String.fromCharCode(e+61);return b};vorple.core.init=function(a){this._init(a);b(document).trigger("init.vorple")};vorple.core.requireRelease=function(a,d){var c,e=!1,f;b.isArray(a)?(c=a[0],e=a[1],f=c+"-"+e):f=c=a;if(c>this.release||!1!==e&&e<this.release)switch(typeof d){case "function":d();break;case "string":throw Error(d);
default:throw Error("Version mismatch: release "+f+" required, currently running release "+this.release);}return!0}})(jQuery);(function(b){vorple.button={};vorple.button.defaults={groupParent:"<div>"};vorple.button.template=function(){this.defaults={classes:""}};vorple.button.template.prototype.init=function(a,d,c){this.opt="object"===typeof c?b.extend({},this.defaults,c):"object"===typeof d?b.extend({},this.defaults,d):b.extend({},this.defaults);this.content="undefined"!==typeof a?a:"";this.idClass="button_"+vorple.core.generateId();this.opt.classes+=" vorpleButton basicButton "+this.idClass;this.options=c;this.element=
this.createElement(a,this.opt);this.onclick="function"===b.type(d)?d:"string"===b.type(d)?function(a){vorple.undum.doClick(d);a.preventDefault()}:b.noop;this.createClickEvent(this.onclick)};vorple.button.template.prototype.createClickEvent=function(a){var d=this;b(document).on("click","."+this.idClass,function(b){d.isEnabled()&&a(b)})};vorple.button.template.prototype.createElement=function(a){return a};vorple.button.template.prototype.disable=b.noop;vorple.button.template.prototype.enable=b.noop;
vorple.button.template.prototype.isEnabled=b.noop;vorple.button.template.prototype.html=function(){return this.element};vorple.button.Button=function(a,b,c){this.init(a,b,c)};vorple.button.Button.inherits(vorple.button.template);vorple.button.Button.prototype.createElement=function(a,b){return vorple.html.tag("button",a,b)};vorple.button.Button.prototype.disable=function(){b("."+this.idClass).prop("disabled",!0)};vorple.button.Button.prototype.enable=function(){b("."+this.idClass).prop("disabled",
!1)};vorple.button.Button.prototype.isEnabled=function(){return!b("."+this.idClass).prop("disabled")};vorple.button.Link=function(a,b,c){this.defaults={classes:"",href:"#"};this.init(a,b,c)};vorple.button.Link.inherits(vorple.button.template);vorple.button.Link.prototype.createElement=function(a,b){return this.tag=vorple.html.link(b.href,a,b)};vorple.button.Link.prototype.disable=function(){b("."+this.idClass).replaceWith('<span class="ex_link '+this.opt.classes+'">'+this.content+"</span>")};vorple.button.Link.prototype.enable=
function(){b("."+this.idClass).replaceWith(this.tag)};vorple.button.Link.prototype.isEnabled=function(){return!b("."+this.idClass).hasClass("ex_link")};vorple.button.Image=function(a,b,c){this.enabled=!0;this.init(a,b,c)};vorple.button.Image.inherits(vorple.button.template);vorple.button.Image.prototype.createElement=function(a,d){var c=vorple.media.image(a,d);this.url=b(c).attr("src");return c};vorple.button.Image.prototype.disable=function(){this.enabled=!1;"disabledImage"in this.opt&&b("."+this.idClass).attr("src",
this.opt.disabledImage)};vorple.button.Image.prototype.enable=function(){this.enabled=!0;b("."+this.idClass).attr("src",this.url)};vorple.button.Image.prototype.isEnabled=function(){return this.enabled};vorple.button.Group=function(a,d){function c(a){"string"===typeof a||"object"===typeof a&&"undefined"!==typeof a.jquery?e.append(a):a&&e.append(a.html())}var e,f=[];"object"===b.type(d)||"undefined"===typeof d||!d?"object"===b.type(d)&&"undefined"!==typeof d.jquery?e=d:("object"!==b.type(d)?d={tag:"div"}:
"undefined"===typeof d.tag&&(d.tag="div"),e=b(vorple.html.tag(d.tag,null,d,{endTag:"never"}))):e="string"===b.type(d)?b(d):b(vorple.button.defaults.groupParent);"array"===b.type(a)?f=a:"undefined"!==typeof a&&a&&f.push(a);b.each(f,function(a,b){c(b)});this.add=function(a){b.each(typeof a!=="array"?[a]:a,function(a,d){var e=false;typeof d==="object"&&"idClass"in d&&b.each(f,function(a,b){typeof b==="object"&&("idClass"in b&&d.idClass==b.idClass)&&(e=true)});if(!e){f.push(d);c(d)}})};this.contains=
function(a){return b.inArray(a,f)>-1};this.enable=function(){b.each(f,function(a,c){b.isFunction(c.enable)&&c.enable()})};this.disable=function(){b.each(f,function(a,c){b.isFunction(c.disable)&&c.disable()})};this.html=function(){return vorple.html.$toHtml(e)};this.update=function(a,d){var i=[];if(d){b.each(f,function(c,d){typeof d==="object"&&"idClass"in d&&b.each(a,function(a,b){typeof b==="object"&&("idClass"in b&&d.idClass==b.idClass)&&i.push(b)})});b.each(a,function(a,c){var d=false;typeof c===
"object"&&"idClass"in c&&b.each(i,function(a,b){typeof b==="object"&&("idClass"in b&&b.idClass==c.idClass)&&(d=true)});d||i.push(c)})}else i=a;b.type(a)!=="array"&&(i=[a]);f=i;e.html("");b.each(i,function(a,b){c(b)})}}})(jQuery);(function(b){vorple.cookie={};vorple.cookie.defaults={expires:365};vorple.cookie.list=function(){for(var a=[],d=document.cookie.split(";"),c=0;c<d.length;++c)a.push(b.trim(d[c].split("=")[0]));return a};vorple.cookie.read=function(a,d){var c,e=b.extend({},self.defaults,d).raw?function(a){return a}:decodeURIComponent;return(c=RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)").exec(document.cookie))?e(c[1]):null};vorple.cookie.remove=function(a){this.write(a,null)};vorple.cookie.write=function(a,d,
c){c=b.extend({},this.defaults,c);if(null===d||void 0===d)c.expires=-1;if("number"===typeof c.expires){var e=c.expires,f=c.expires=new Date;f.setDate(f.getDate()+e)}d=String(d);return document.cookie=[encodeURIComponent(a),"=",c.raw?d:encodeURIComponent(d),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}})(jQuery);(function(b){vorple.html={};vorple.html.defaults={allowedTagAttributes:"accesskey abbr align alt axis border cellpadding cellspacing char charoff class colspan dir disabled frame headers height href id ismap lang longdesc multiple name onblur onclick ondblclick onfocus onkeydown onkeypress onkeyup onmousedown onmouseout onmouseover onmouseup rel rev rowspan rules scope size src style summary tabindex target title type usemap valign value width".split(" "),endTag:"auto",quotemarks:'"'};vorple.html._createLink=
function(a){var d=b.extend({},{endTag:"always"},a.options);d.href=a.url;return this.tag("a",a.content,d)};vorple.html.$toHtml=function(a){return"undefined"===typeof a.jquery?!1:a.first().clone().wrap("<div></div>").parent().html()};vorple.html.attributes=function(a){var d=this,c=b.extend({},d.defaults,a),e="";"undefined"!==typeof c.classes&&(e=' class="'+c.classes+'"');b.each(c,function(a,g){if(-1<b.inArray(a,c.allowedTagAttributes)||0===a.indexOf("data-"))e+=" "+a+'="'+d.escapeHtmlChars(g)+'"'});
c.escape&&(e=d.escapeHtmlChars(e));return e};vorple.html.escapeHtmlChars=function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};vorple.html.link=function(a,d,c){var e=this,c=b.extend({},{classes:""},e.defaults,c);if(b.isArray(a)){var f=vorple.core.generateId(),g=b(vorple.html.tag("ul",null,{endTag:"always",classes:"options linkPopup popup_"+f,style:"display:none; position:absolute;"}));b.each(a,function(a,c){b("<li>").append(b(e.link(c))).appendTo(g)});
b("body").on("click",".popuplink_"+f,function(a){a.preventDefault();a.stopPropagation();b(".linkPopup").hide();g.appendTo("body").show().offset({left:a.pageX,top:a.pageY})});b("body").on("click",".popup_"+f+" a",function(a){a.preventDefault();vorple.undum.doLink(b(this).attr("href"));b(".linkPopup").hide();return!1});c.classes+="popupLink popuplink_"+f;return vorple.html.link("#",d,c)}return"object"===typeof a?e._createLink(a):e._createLink({url:a,content:d,options:c})};b(document).bind("init.vorple",
function(){b(document).on("click",function(){b(".linkPopup").hide()})});vorple.html.p=function(a,b){return vorple.html.tag("p",a,b)};vorple.html.quote=function(a,b){var c,e;"undefined"==typeof b&&(b=this.defaults.quotemarks);"string"==typeof b?e=c=b:(c=b[0],e=b[1]);return c+a+e};vorple.html.replaceAttributes=function(a,d){for(var c=a.get(0).attributes,e=0;e<c.length;++e)a.attr(c[e].name,"");b.each(d,function(b,c){"classes"==b?a.attr("class",c):a.attr(b,c)})};vorple.html.tag=function(a,d,c){var e=
b.extend({},this.defaults,c),c="<"+a+this.attributes(e);"always"==e.endTag||"auto"==e.endTag&&"string"===typeof d?("string"!==typeof d&&!d&&(d=""),a=">"+d+"</"+a+">"):a=d?">"+d:"auto"==e.endTag?" />":">";return c+a};vorple.html.url=function(a,b){return"undefined"===typeof a||!a?b?b:"#":"undefined"==typeof b||!b||a.match(/^[a-zA-Z]*:\/\//)||0===a.indexOf("/")||0===a.indexOf(".")?a:b+"/"+a}})(jQuery);(function(b){vorple.media={_muted:{music:!1,sound:!1}};vorple.media.defaults={type:"sound",audioPath:"media/audio",imagePath:"media/image",musicPath:"media/music",videoPath:"media/video",muted:!1,mainContainer:"vorple-media",musicContainer:"vorple-music",soundContainer:"vorple-sound",playerSolution:"html, flash",preload:"auto",swfPath:"lib",volume:0.8};vorple.media._createMainContainer=function(a,d){0==b("#"+a).length&&("undefined"===typeof d&&(d=b("body")),d.append(b('<div id="'+a+'"></div>')));
return b("#"+a)};vorple.media._createPlayer=function(a){a=b.extend({},this.defaults,a);if("string"==typeof a.element)return b("#"+a.element);if("object"===b.type(a.element)&&a.element.jquery)return a.element;a="object"===typeof a.parent&&a.parent.jquery?a.parent:"string"===typeof a.parent?this._createMainContainer(a.parent,b("#"+a.mainContainer)):"object"===typeof a.mainContainer&&a.mainContainer.jquery?a.mainContainer:b("#"+a.mainContainer);$element=b('<div id="jplayer_'+vorple.core.generateId()+
'" class="jp-jplayer"></div>');a.append($element);return $element};vorple.media.mute=function(a,d){var c=b.extend({},this.defaults,d);"undefined"!==typeof a.music&&(this._muted.music=a.music,b("#"+c.musicContainer).jPlayer(a.music?"mute":"unmute"),b('input.mute[value="music"]').attr("checked",a.music),b('input.unmute[value="music"]').attr("checked",!a.music),a.music?b('input.unmute[value="all"]').attr("checked",!1):b('input.mute[value="all"]').attr("checked",!1));"undefined"!==typeof a.sound&&(this._muted.sound=
a.sound,b("#"+c.soundContainer).children().jPlayer(a.sound?"mute":"unmute"),b('input.mute[value="sound"]').attr("checked",a.sound),b('input.unmute[value="sound"]').attr("checked",!a.sound));b('input.mute[value="all"]').attr("checked",this._muted.sound&&this._muted.music);b('input.unmute[value="all"]').attr("checked",!this._muted.sound&&!this._muted.music);vorple.cookie.write("vorpleMute",(this._muted.sound?"1":"0")+","+(this._muted.music?"1":"0"))};vorple.media.muteAll=function(a){"undefined"==typeof a&&
(a=!0);this.mute({music:a,sound:a});return a};vorple.media._play=function(a,d){var c=b.extend({},this.defaults,d),e;if(c.onReady)var f=c.onReady;e="undefined"==typeof c.container||!c.container?this._createPlayer(d):c.container;e.jPlayer("destroy");var g={},h=[];b.each(a,function(a,b){g[a]=vorple.html.url(b,c.audioPath);h.push(a)});e.jPlayer({muted:c.muted,preload:"auto",ready:function(){b(this).jPlayer("setMedia",g).jPlayer("play");b.isFunction(f)&&f()},solution:c.solution,supplied:h.join(", "),swfPath:c.swfPath,
volume:c.volume});return e};vorple.media.image=function(a,d){var c=this.defaults.imagePath;"object"===typeof d&&"undefined"!==typeof d.imagePath&&(c=d.imagePath);c=b.extend({},{src:vorple.html.url(a,c)},d);return vorple.html.tag("img",null,c)};vorple.media.isMuted=function(a){var d=this,c=a,e=[];"string"==typeof a&&(c=[a]);b.each(c,function(a,b){"all"===b?e.push(d._muted.sound&&d._muted.music):e.push(d._muted[b])});return"string"==typeof a?e[0]:e};vorple.media.playMusic=function(a,d){var c=b.extend({},
this.defaults,d);c.audioPath=this.defaults.musicPath;this._muted.music&&(c.muted=!0);$musicContainer=this._createMainContainer(c.musicContainer,b("#"+c.mainContainer));c.container=$musicContainer;return this._play(a,c)};vorple.media.playSound=function(a,d){if(!vorple.core.engine("undum")||undum.isInteractive()){var c=b.extend({},this.defaults,d);this._muted.sound&&(c.muted=!0);$container=this._createMainContainer(c.soundContainer,b("#"+c.mainContainer));c.mainContainer=$container;c=this._play(a,c);
c.bind(b.jPlayer.event.ended,function(){b(this).jPlayer("destroy")});return c}};vorple.media.preloadImage=function(a,d){var c=b.extend({},this.defaults,d);if("string"==typeof a){var e=new Image;e.src=vorple.html.url(a,c.imagePath);return e}if(b.isArray(a)){var f=[];b.each(a,function(){var a=new Image;a.src=vorple.html.url(this,c.imagePath);f.push(a)});return f}throw Error("Illegal file type given to the image preloader (only String and Array allowed)");};vorple.media.stopAll=function(){this.stopMusic();
this.stopSounds()};vorple.media.stopMusic=function(){b("#"+this.defaults.musicContainer).jPlayer("destroy")};vorple.media.stopSounds=function(){b("#"+this.defaults.soundContainer).children().jPlayer("destroy")};vorple.media.toggleMute=function(a){var d=this,c=a,e=[];"string"==typeof a&&(c=[a]);var f={};b.each(c,function(a,b){f[b]=!d._muted[b];e.push(!d._muted[b])});d.mute(f);return"string"==typeof a?e[0]:e};vorple.media.youtube=function(a,d){var c=b.extend({},this.defaults.youtube,d),e="http://www.youtube.com/v/"+
a+"?version=3",f=b.param(c.parameters);f&&(e+="&"+f);return'<object width="'+c.width+'" height="'+c.height+'"><param name="movie" value="'+e+'"></param><param name="allowScriptAccess" value="always"></param><embed src="'+e+'" type="application/x-shockwave-flash" allowscriptaccess="always" width="'+c.width+'" height="'+c.height+'"></embed></object>'};vorple.media.defaults.youtube={width:600,height:365,parameters:{autoplay:"1",controls:"0",disablekb:"1",modestbranding:"1",rel:"0"}};b(document).bind("init.vorple",
function(){0==b("#"+vorple.media.defaults.mainContainer).length&&b("body").append(b('<div id="'+vorple.media.defaults.mainContainer+'"></div>'));var a=vorple.cookie.read("vorpleMute");a&&(a=a.split(","),vorple.media.mute({sound:"1"==a[0],music:"1"==a[1]}));b(document).delegate("input.mute","change",function(){var a=b(this);if(a.val()=="all")vorple.media.muteAll(a.is(":checked"));else{var c={};c[a.val()]=a.is(":checked");vorple.media.mute(c)}});b(document).delegate("input.unmute","change",function(){var a=
b(this);if(a.val()=="all")vorple.media.muteAll(!a.is(":checked"));else{var c={};c[a.val()]=!a.is(":checked");vorple.media.mute(c)}})})})(jQuery);(function(b){vorple.notify={};vorple.notify.defaults={layout:"bottomRight",timeout:7E3};vorple.notify._currentNoty=null;vorple.notify.alert=function(a,d){var c=b.extend({},{buttons:[{text:"OK",onClick:function(a){a.close()}}],layout:"center",modal:!0,timeout:!1},d);vorple.notify.show(a,c)};vorple.notify.clearQueue=function(){b.noty.clearQueue()};vorple.notify.close=function(){b.noty.close(this._currentNoty)};vorple.notify.closeAll=function(){b.noty.closeAll()};vorple.notify.show=function(a,d){var c=
b.extend({},this.defaults,d,{text:a});this._currentNoty=noty(c)}})(jQuery);(function(b){vorple.parser={_container:{parchment:null,vorple:"#vorple"},_evalqueue:[],_filters:{},_skipFilters:!1,_scrollPosition:0,_turn:{commandVisible:!0,outputVisible:!0,type:"normal"}};vorple.parser._createPrompt=function(a){return b("<span>"+a+"</span>").addClass("vorplePrompt").append('<input type="text" />')};vorple.parser._evaluateQueue=function(){b.each(vorple.parser._evalqueue,function(a,b){try{b()}catch(c){console.log("Invalid JavaScript: "+b)}});vorple.parser._evalqueue=[]};vorple.parser._metaTurnFilters=
function(a,b){if(!a)return!1;switch(b.turn.type){case "error":a.classes+="parserError ";a.previousCommand.classes+="parserError ";a.content.classes+="transient ";a.meta=!0;break;case "meta":return vorple.notify.show(a.content.text),!1;case "dialog":return vorple.notify.show(a.content.text,{buttons:[{type:"button",text:"ok",click:function(a){a.close()}}],closeButton:!0,layout:"center",modal:!0,timeout:!1}),!1}return a};vorple.parser._runFilters=function(a,d,c){if(this._skipFilters)return a;var e=b.extend({},
vorple.parser._filters),f=0;for(key in e)e.hasOwnProperty(key)&&f++;for(var g=0;g<f;++g){var h=void 0;b.each(e,function(a,b){if(b.type===d&&(void 0===h||h.priority<b.priority))h=b});void 0!==h&&(a=h.filter(a,c),delete e[h.name])}return a};vorple.parser.hideCommand=function(a){"undefined"===typeof a&&(a=!0);this._turn.commandVisible=!a};vorple.parser.hideOutput=function(a){"undefined"===typeof a&&(a=!0);this._turn.outputVisible=!a};vorple.parser.registerFilter=function(a,d){var c=b.extend({priority:0,
name:"filter_"+vorple.core.generateId(),type:"output"},d);this._filters[c.name]={filter:a,name:c.name,priority:c.priority,type:c.type};return this._filters[c.name]};vorple.parser.scrollTo=function(a){var d=b(document).height()-b(window).height();switch(a){case "bottom":a=d;break;case "top":a=0;break;default:a="object"===typeof a&&a.jquery?a.offset().top:a}a>d&&(a=d);b("html, body").animate({scrollTop:a},150)};vorple.parser.sendCommand=function(a,d){var c=b.extend({hideCommand:!1,hideOutput:!1,skipFilters:!1},
d),e=b("input.TextInput");e.val();c.hideOutput&&this.hideOutput();c.hideCommand&&this.hideCommand();c.skipFilters&&(this._skipFilters=!0);e.val(a).trigger(b.Event("keydown",{which:13}));this._skipFilters=!1};vorple.parser.sendSilentCommand=function(a){this.sendCommand(a,{hideCommand:!0,hideOutput:!0,skipFilters:!0})};vorple.parser.setTurnType=function(a){this._turn.type=a};vorple.parser.unregisterFilter=function(a){delete this._filters[a]};b(document).on("init.vorple",function(){vorple.core.engine("parchment")&&
(vorple.parser._container.parchment=vorple.core.system.options.container,vorple.parser.registerFilter(vorple.parser._metaTurnFilters,{type:"output",name:"meta-turn filters"}),b(document).on("click.vorple","a.command",function(a){a.preventDefault();var a=b(this).attr("href"),d={hideCommand:b(this).hasClass("hideCommand"),hideOutput:b(this).hasClass("hideResponse")};vorple.parser.sendCommand(a,d);return!1}),b(document).on("keydown.vorple",".vorplePrompt input",function(a){if(13===a.which)return a.preventDefault(),
a=vorple.parser._runFilters(b(this).val(),"input"),vorple.parser.sendCommand(a),!1}),b(document).off(".TextInput"),b(document).on("click.vorple keydown.vorple",function(a){var d=b(".vorplePrompt input");if("INPUT"!==a.target.nodeName&&"A"!==a.target.nodeName&&(window.getSelection()||""==(document.selection?document.selection.createRange().text:"")))if(-60<b(window).scrollTop()+b(window).height()-d.offset().top)vorple.parser.scrollTo("bottom"),a.target=d[0],d.focus().trigger(a),a.stopPropagation();
else if("keydown"==a.type&&8==a.which)return!1}),b(document).bind("TextInput.vorple",function(){b(".transient",vorple.parser._container.vorple).animate({opacity:0},1500).slideUp(500,function(){b(this).remove()});vorple.parser.setTurnType("normal")}),b(document).bind("TurnComplete.vorple",function(){var a=b(".main",vorple.parser._container.parchment),d=b(vorple.parser._container.vorple),c=a.clone(),e=b("span:first",c),f=e.contents().first(),g=f.text();f.is("br")||b("br:first",e).remove();f.remove();
e=b("span:last",c);f=e.contents().filter(function(){return 3==this.nodeType}).first().text();b("br",e).appendTo(e.prev());e.remove();g=vorple.parser._runFilters({previousCommand:{text:g,classes:""},content:{text:c.html(),classes:""},prompt:{text:f,val:"",classes:""},meta:!1,classes:""},"output",{turn:vorple.parser._turn});if("object"!==typeof g||!vorple.parser._turn.commandVisible&&!vorple.parser._turn.outputVisible)return b("input",a).appendTo("body").hide(),a.empty(),b(".vorplePrompt input").val(""),
vorple.parser.hideCommand(!1),vorple.parser.hideOutput(!1),vorple.parser._evaluateQueue(),!1;if(vorple.parser._turn.outputVisible){c.html(g.content.text).addClass(g.content.classes);var h=b("<div></div>").append(c)}c=g.prompt.val;vorple.parser._turn.commandVisible?b(".vorplePrompt input",d).replaceWith(b("<span></span>").addClass("previousCommand").addClass(g.previousCommand.classes).html(g.previousCommand.text)):(c=b(".vorplePrompt input",d).val(),b(".vorplePrompt:last",d).remove());h.addClass("turnContent").addClass(g.turnClasses);
$newTurnContainer=b("<div></div>").addClass("turn").addClass(g.classes).append(h);g.meta||(b(".penultimateTurn").removeClass("penultimateTurn"),b(".previousTurn").addClass("penultimateTurn").removeClass("previousTurn").addClass("previousTurnFader").removeClass("previousTurnFader",1E3),$newTurnContainer.addClass("previousTurn"));b(vorple.parser._createPrompt(g.prompt.text)).addClass(g.prompt.classes).appendTo($newTurnContainer).find("input").val(c);$newTurnContainer.appendTo(d);vorple.parser._evaluateQueue();
b("input",a).appendTo("body").hide();a.empty();vorple.parser.hideCommand(!1);vorple.parser.hideOutput(!1);vorple.parser.scrollTo(h)}))});vorple.parchment=vorple.parser})(jQuery);(function(b){vorple.tabs={};vorple.tabs.create=function(a){var d=a;if("object"!=typeof a||!a.jquery)d=b(a);if(!b.tabs)throw Error("jQuery UI tabs is not installed");return d.tabs()}})(jQuery);(function(b){vorple.tooltip={};vorple.tooltip.defaults={show:{event:"mouseenter",ready:!1},content:{attr:"title"},position:{my:"bottom left",at:"top center"},overwrite:!1,delay:3E3,duration:1E4};vorple.tooltip._create=function(a,d){var c=b.extend({},this.defaults,d),e=b(a);!c.content&&e.attr(c.content.attr);c.content&&e.qtip(c);return e};vorple.tooltip.enable=function(a,d){var c=this,e=b.extend(!0,{},c.defaults,{show:{ready:!0,event:c.defaults.show.event}},d);return b(document).delegate(a,e.show.event,
function(){c._create(this,e)})};vorple.tooltip.show=function(a,d,c){"undefined"===typeof d&&(d=!0);var e=b.extend({},this.defaults,{show:{ready:!1,event:!1},hide:{event:!1},content:{text:d},events:{hide:function(a,b){b.destroy()}}},c),f=this._create(a,e);return setTimeout(function(){0<f.length&&(f.qtip("show"),setTimeout(function(){0<f.length&&f.qtip("hide")},e.duration))},e.delay)}})(jQuery);(function(b){vorple.undum={};vorple.undum.settings={allDisposable:!1,disposableLinks:[],disposableExceptions:[]};vorple.undum._afterTurnTasks=function(a,d,c,e){var f=this;f.settings.allDisposable?-1==b.inArray(e,f.settings.disposableExceptions)&&f.dispose(e):-1<b.inArray(e,f.settings.disposableLinks)&&f.dispose(e);b.each(undum.game._disposedLinks,function(a,b){f._removeDisposed(b)});f._enforceUnique()};vorple.undum._enforceUnique=function(){b("#content").find("a").each(function(a,d){var c=b(d),e=
c.attr("href"),f=!1;c.hasClass("unique")&&b('#content a[href="'+e+'"]').each(function(a,c){var d=b(c);d.hasClass("unique")&&!f?f=!0:d.replaceWith(b("<span>").html(d.html()))})})};vorple.undum._removeDisposed=function(a){b("a[href$='"+a+"'], a[href='"+a+"']").each(function(a,c){var e=b(c);e.replaceWith(b("<span>").addClass("ex_link").html(e.html()))})};vorple.undum.afterActionTrigger=function(a,b,c,e){this._afterTurnTasks(a,b,c,e);return!1};vorple.undum.afterEnterTrigger=function(a,b,c,e){this._afterTurnTasks(a,
b,c,e);return!1};vorple.undum.dispose=function(){var a=this;b.each(arguments,function(d,c){if(b.isArray(c))b.each(c,function(b,c){a.dispose(c)});else if(!a.isDisposed(c)){var e=c.split("/");undum.game._disposedLinks.push(e[e.length-1]);a._removeDisposed(c)}})};vorple.undum.doClick=function(a){vorple.core.system.doClick(a)};vorple.undum.doLink=function(a){vorple.core.system.doLink(a)};vorple.undum.isDisposed=function(a){return-1<b.inArray(a,undum.game._disposedLinks)};vorple.undum.reactivate=function(){var a=
this;b.each(arguments,function(d,c){if(b.isArray(c))b.each(c,function(b,c){a.reactivate(c)});else{var e=c.split("/"),e=b.inArray(e[e.length-1],undum.game._disposedLinks);-1<e&&undum.game._disposedLinks.splice(e,1)}})};b(document).bind("init.vorple",function(){if(vorple.core.engine("undum")&&(undum.game.afterEnter||(undum.game.afterEnter=function(a,b,c,e){return vorple.undum.afterEnterTrigger(a,b,c,e)}),undum.game.afterAction||(undum.game.afterAction=function(a,b,c,e){return vorple.undum.afterActionTrigger(a,
b,c,e)}),"undefined"===typeof undum.game._disposedLinks))undum.game._disposedLinks=[]})})(jQuery);
